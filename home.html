<head>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> 

    <script>
        var clientId = undefined;
        var lobbyId = undefined;
        var alias = undefined;
    </script>
</head>

<body>
    <div class="page active" id="connectingPage">
        <div>Connecting...</div>
    </div>

    <div class="page" id="mainMenuPage">
        <div id="titleBar">
            <div style="flex:1; text-align: left; font-size: 100%;"><h3>High Score:</h3></div>
            <div style="flex:2; text-align:center"> <h1>Rainbow Universe</h1> </div>
            <div id="UserInfo" style="flex:1; text-align: right;"><button id="userAlias"></button>
                <div></div>
            </div>
        </div>
        <div>
            <br><br><br><br><br><br><br><br><br><br><!-- temp ;) -->
            <div id="menuOptions">
                <div><button onmousedown="quickPlay()" style="background-color: aqua;">Quick Play</button></div>
                <div><button onmousedown="createLobby()" style="background-color: orange;">Create Lobby</button></div>
                <div><button onmousedown="joinLobby()" style="background-color: rgb(80, 223, 80);">Join Lobby</button></div>
                <div><button onmousedown="rankedLobby()" style="background-color: rgb(211, 112, 211);">Ranked</button></div>
                <div><button onmousedown="showLeaderBoard()" style="background-color: rgb(224, 49, 49);">Leader Boards</button></div>
            </div>
        </div>

        <div class="page" id = "joinLobbyPage">
            
        </div>
    </div>

    
    <div class="page" id="lobbyPage">
        Lobby or something
    </div>

    <div class="page" id="leaderBoardPage">
        <div id="titleBar">
            <div style="flex:1; text-align: left; font-size: 100%;"><h3>High Score:</h3></div>
            <div style="flex:2; text-align:center"> <h1>Rainbow Universe</h1> </div>
            <div id="UserInfo" style="flex:1; text-align: right;"><button id="userAlias"></button>
                <div></div>
            </div>
        </div>
        Leader boards
    </div>
</body>


<script>

    var onShowPage = {
        "mainMenuPage": function(page){
            document.getElementById("userAlias").innerHTML = alias;
        }
    };

    var onHidePage = {

    };


    var showPages = function(pages){
        for(var i=pages.length-1; i>=0; i--){
            var pageElement = document.getElementById(pages[i]);
            var activePages = pageElement.parentElement.getElementsByClassName("active")
            for(var j=activePages.length-1; j>=0; j--){
                (onHidePage[activePages[j].id] || function(){})();
                activePages[j].classList.remove("active");
            }

            pageElement.classList.add("active");
            console.log(pages[i]);
            (onShowPage[pages[i]] || function(){})(pageElement);
        }
    }

    const host = "ws://127.0.0.1:9995/";
    var socket = new WebSocket(host);

    var setAlias = function(alias){
        socket.send("cl_alias|" + alias);
    }

    var createLobby = function(){
        socket.send("lb_create|");
    }

    var joinLobby = function(lobbyId){
        socket.send("lb_join|" + lobbyId);
    }

    var leaveLobby = function(lobbyId){
        socket.send("lb_leave|");
    }

    var kickPlayerFromLobby = function(clientId){
        socket.send("lb_kick|" + clientId);
    }

    var banPlayerFromLobby = function(clientId){
        socket.send("lb_ban|" + clientId);
    }

    socket.onopen = function(){
        console.log("Connected");
    }

    socket.onerror = function(e){
        console.log("Error");
        console.log(e);
    }

    socket.onclose = function(e){
        console.log("Closed");
        console.log(e);
    }

    socket.onmessage = function(e){
        var messageData = e.data.split("|")
        var type        = messageData[0];
        var message     = messageData[1];
        
        (({
            "sv_error":function(message){
                console.log("Server encountered an error: " + message);
            },

            "cl_init":function(message){
                var clientInfo = message.split(":")
                clientId = clientInfo[1];
                if(alias === undefined){
                    alias = clientInfo[0];
                }else{
                    setAlias(alias);
                }

                document.cookie = "clientId=" + message;
                console.log("Client ID =", clientId);
                showPages(["mainMenuPage"]);
            },

            "cl_alias":function(message){
                alias = message;
                console.log("Alias changed:", alias);
            },

            "lb_init":function(message){
                lobbyId = message;
                console.log("Lobby created");
                console.log("Lobby ID =", lobbyId);
            },

            "lb_joined":function(message){
                var lobbyPlayers = message.split(",");
                console.log("lobby joined", lobbyPlayers);
            },

            "lb_kicked":function(message){
                console.log("You have been kicked from the lobby");
            },

            "lb_banned":function(message){
                console.log("You have been banned from the lobby");
            },

            "lb_promoted":function(message){
                console.log("You have been promoted to lobby leader");
            },

            "lb_updated":function(message){
                console.log("The lobby is being updated");
            },
        })[type] || function(){})(message);
    }

</script>